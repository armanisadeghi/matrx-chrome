<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matrx - {{contentType}}</title>
    <!-- Shared styles will be inlined by template loader -->
</head>
<body>
    <div class="matrx-container">
        <!-- Content sections come first so :target works properly -->
        <div id="textContent" class="matrx-content-view matrx-text-view">{{textContent}}</div>
        <div id="formattedContent" class="matrx-content-view matrx-formatted-view">{{formattedHtml}}</div>
        
        <div class="matrx-header">
            <h1>
                <svg style="width: 20px; height: 20px; fill: currentColor; vertical-align: middle; margin-right: 8px;" viewBox="0 0 24 24">
                    <path d="M12,2A2,2 0 0,1 14,4C14,4.74 13.6,5.39 13,5.73V7A1,1 0 0,0 14,8H16A1,1 0 0,0 17,7V5.73C16.4,5.39 16,4.74 16,4A2,2 0 0,1 18,2A2,2 0 0,1 20,4C20,4.74 19.6,5.39 19,5.73V7A3,3 0 0,1 16,10H15V16A1,1 0 0,0 16,17H18A1,1 0 0,0 19,16V14.27C19.6,13.93 20,13.28 20,12.5A2,2 0 0,1 22,14.5A2,2 0 0,1 20,16.5C20,17.24 19.6,17.89 19,18.23V16A3,3 0 0,1 16,19H8A3,3 0 0,1 5,16V18.23C4.4,17.89 4,17.24 4,16.5A2,2 0 0,1 2,14.5A2,2 0 0,1 4,12.5C4,13.28 4.4,13.93 5,14.27V16A1,1 0 0,0 6,17H8A1,1 0 0,0 9,16V10H8A3,3 0 0,1 5,7V5.73C4.4,5.39 4,4.74 4,4A2,2 0 0,1 6,2A2,2 0 0,1 8,4C8,4.74 7.6,5.39 7,5.73V7A1,1 0 0,0 8,8H10A1,1 0 0,0 11,7V5.73C10.4,5.39 10,4.74 10,4A2,2 0 0,1 12,2Z"/>
                </svg>
                Matrx - {{contentType}}
            </h1>
            <p class="subtitle">AI-extracted clean text with dual viewing modes</p>
            <div class="matrx-header-actions">
                <a href="#textContent" class="matrx-btn matrx-view-toggle matrx-text-toggle">
                    <svg class="matrx-btn-icon" viewBox="0 0 24 24">
                        <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                    </svg>
                    Text View
                </a>
                <a href="#formattedContent" class="matrx-btn matrx-view-toggle matrx-formatted-toggle">
                    <svg class="matrx-btn-icon" viewBox="0 0 24 24">
                        <path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
                    </svg>
                    Formatted View
                </a>
                <button class="matrx-btn" id="copyBtn">
                    <svg class="matrx-btn-icon" viewBox="0 0 24 24">
                        <path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/>
                    </svg>
                    Copy Content
                </button>
            </div>
        </div>
        
        <div class="matrx-content-wrapper">
            <!-- Content is positioned here visually but defined above for :target -->
        </div>
    </div>

    <!-- Content is embedded directly in the page for direct clipboard access -->
    
        <script>
            // Store content directly in the page for direct clipboard access
            const TEXT_CONTENT = `{{textContentEncoded}}`;
            const FORMATTED_TEXT = `{{formattedTextEncoded}}`;
            
            // Visual debugging element (since console doesn't work in blob URLs)
            let debugDiv = null;
            
            function showDebug(message) {
                if (!debugDiv) {
                    debugDiv = document.createElement('div');
                    debugDiv.style.cssText = `
                        position: fixed;
                        top: 10px;
                        right: 10px;
                        background: rgba(0,0,0,0.9);
                        color: white;
                        padding: 12px;
                        border-radius: 8px;
                        font-size: 11px;
                        z-index: 10000;
                        max-width: 300px;
                        word-wrap: break-word;
                        font-family: monospace;
                        border: 1px solid #333;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    `;
                    document.body.appendChild(debugDiv);
                }
                const timestamp = new Date().toLocaleTimeString();
                debugDiv.innerHTML = `[${timestamp}] ${message}<br>` + (debugDiv.innerHTML || '');
                
                // Auto-hide debug after 8 seconds
                setTimeout(() => {
                    if (debugDiv && debugDiv.parentNode) {
                        debugDiv.style.opacity = '0.5';
                    }
                }, 8000);
            }
            
            showDebug(`Dual View loaded - Text: ${TEXT_CONTENT.length} chars, Formatted: ${FORMATTED_TEXT.length} chars`);
            
            // Direct clipboard access (should work with clipboardWrite permission)
            function setupCopyButton() {
                const copyBtn = document.getElementById('copyBtn');
                if (!copyBtn) {
                    showDebug('ERROR: Copy button not found!');
                    return;
                }
                
                showDebug('Copy button found and event listener attached');
                
                copyBtn.addEventListener('click', async function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const isFormattedView = window.location.hash === '#formattedContent';
                    const contentToCopy = isFormattedView ? 
                        decodeURIComponent(FORMATTED_TEXT) : 
                        decodeURIComponent(TEXT_CONTENT);
                    
                    showDebug(`Copy clicked - View: ${isFormattedView ? 'formatted' : 'text'}, Length: ${contentToCopy.length}`);
                    
                    if (!contentToCopy || contentToCopy.length === 0) {
                        showDebug('ERROR: No content available');
                        showCopyFeedback(copyBtn, '❌ No Content', 'error');
                        return;
                    }
                    
                    try {
                        showDebug('Attempting direct clipboard access...');
                        
                        // Direct clipboard access - should work with clipboardWrite permission
                        await navigator.clipboard.writeText(contentToCopy);
                        showCopyFeedback(copyBtn, '✅ Copied!', 'success');
                        showDebug('SUCCESS: Content copied via navigator.clipboard');
                        
                    } catch (error) {
                        showDebug(`Clipboard API failed: ${error.message}, trying fallback...`);
                        
                        try {
                            // Fallback to execCommand method
                            const textArea = document.createElement('textarea');
                            textArea.value = contentToCopy;
                            textArea.style.position = 'fixed';
                            textArea.style.left = '-9999px';
                            textArea.style.top = '-9999px';
                            document.body.appendChild(textArea);
                            textArea.focus();
                            textArea.select();
                            
                            const success = document.execCommand('copy');
                            document.body.removeChild(textArea);
                            
                            if (success) {
                                showCopyFeedback(copyBtn, '✅ Copied!', 'success');
                                showDebug('SUCCESS: Content copied via execCommand fallback');
                            } else {
                                showCopyFeedback(copyBtn, '❌ Failed', 'error');
                                showDebug('ERROR: execCommand fallback failed');
                            }
                        } catch (fallbackError) {
                            showCopyFeedback(copyBtn, '❌ Error', 'error');
                            showDebug(`FALLBACK ERROR: ${fallbackError.message}`);
                        }
                    }
                });
            }
            
            // Enhanced feedback with animation
            function showCopyFeedback(button, text, type) {
                const originalText = button.textContent;
                const originalColor = button.style.color;
                
                // Update button text and color
                button.textContent = text;
                button.style.color = type === 'success' ? '#22c55e' : '#ef4444';
                button.style.transform = 'scale(1.05)';
                button.disabled = true;
                
                // Add pulse animation
                button.style.animation = 'pulse 0.3s ease-in-out';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.color = originalColor;
                    button.style.transform = 'scale(1)';
                    button.style.animation = '';
                    button.disabled = false;
                }, 2000);
            }
            
            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', setupCopyButton);
            } else {
                setupCopyButton();
            }
            
            // Debug hash changes
            window.addEventListener('hashchange', function() {
                showDebug('View switched to: ' + window.location.hash);
            });
            
            // Add click handler to debug div to hide it
            document.addEventListener('click', function(e) {
                if (e.target === debugDiv) {
                    debugDiv.style.display = 'none';
                }
            });
        </script>
</body>
</html>
