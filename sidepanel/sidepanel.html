<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matrx Side Panel</title>
    <link rel="stylesheet" href="../styles/theme.css">
    <link rel="stylesheet" href="../styles/icons.css">
    <link rel="stylesheet" href="sidepanel.css">
</head>
<body class="m-base">
    <div class="container">
        <!-- Start Screen Overlay -->
        <div class="start-screen-overlay" id="startScreenOverlay" style="display: none;">
            <div class="start-screen">
                <div class="start-screen-header">
                    <div class="start-screen-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/>
                            <path d="M12 10h2l3 3-3 3h-2v-2h-2v-2h2v-2Z"/>
                        </svg>
                    </div>
                    <h2>Ready to Analyze</h2>
                    <p class="start-screen-subtitle">New page detected - let's analyze the content</p>
                </div>
                
                <div class="start-screen-page-info">
                    <div class="page-info-item">
                        <span class="page-info-label">Current Page</span>
                        <span class="page-info-value" id="startScreenUrl">Loading...</span>
                    </div>
                    <div class="page-info-item">
                        <span class="page-info-label">Domain</span>
                        <span class="page-info-value" id="startScreenDomain">Loading...</span>
                    </div>
                </div>
                
                <div class="start-screen-features">
                    <h3>What you can analyze:</h3>
                    <div class="feature-grid">
                        <div class="feature-item">
                            <svg class="feature-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 3h18v2H3V3zm0 4h12v2H3V7zm0 4h18v2H3v-2zm0 4h12v2H3v-2zm0 4h18v2H3v-2z"/>
                            </svg>
                            <span>Headers Structure</span>
                        </div>
                        <div class="feature-item">
                            <svg class="feature-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"/>
                            </svg>
                            <span>Text Content</span>
                        </div>
                        <div class="feature-item">
                            <svg class="feature-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M10.59 13.41c.41.39.41 1.03 0 1.42-.39.39-1.03.39-1.42 0a5.003 5.003 0 0 1 0-7.07l3.54-3.54a5.003 5.003 0 0 1 7.07 0 5.003 5.003 0 0 1 0 7.07l-1.49 1.49c.01-.82-.12-1.64-.4-2.42l.47-.48a2.982 2.982 0 0 0 0-4.24 2.982 2.982 0 0 0-4.24 0l-3.53 3.53a2.982 2.982 0 0 0 0 4.24zm2.82-4.24c.39-.39 1.03-.39 1.42 0a5.003 5.003 0 0 1 0 7.07l-3.54 3.54a5.003 5.003 0 0 1-7.07 0 5.003 5.003 0 0 1 0-7.07l1.49-1.49c-.01.82.12 1.64.4 2.43l-.47.47a2.982 2.982 0 0 0 0 4.24 2.982 2.982 0 0 0 4.24 0l3.53-3.53a2.982 2.982 0 0 0 0-4.24.996.996 0 0 1 0-1.42z"/>
                            </svg>
                            <span>Links Analysis</span>
                        </div>
                        <div class="feature-item">
                            <svg class="feature-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
                            </svg>
                            <span>Images Analysis</span>
                        </div>
                        <div class="feature-item">
                            <svg class="feature-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                <circle cx="12" cy="8" r="2"/>
                                <path d="M12 14c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                            </svg>
                            <span>AI Summary</span>
                        </div>
                        <div class="feature-item">
                            <svg class="feature-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                            </svg>
                            <span>Markdown View</span>
                        </div>
                    </div>
                </div>
                
                <div class="start-screen-actions">
                    <button class="start-analysis-btn m-btn m-btn-primary" id="startAnalysisBtn">
                        <span class="m-icon m-icon-play btn-icon"></span>
                        <span class="btn-text">Start Analysis</span>
                    </button>
                    <button class="refresh-page-btn m-btn m-btn-secondary" id="refreshPageBtn">
                        <span class="m-icon m-icon-refresh btn-icon"></span>
                        <span class="btn-text">Refresh</span>
                    </button>
                </div>

                <!-- Auth section on start screen -->
                <div class="start-screen-auth" id="startScreenAuth">
                    <!-- Signed out -->
                    <div class="start-auth-signed-out" id="startAuthSignedOut">
                        <div class="start-auth-divider m-divider-text">
                            <span>Sign in to save extractions</span>
                        </div>
                        <div class="start-auth-oauth-grid m-oauth-grid">
                            <button class="start-auth-oauth-btn m-oauth-btn" id="startGoogleSignInBtn">
                                <svg viewBox="0 0 24 24" width="16" height="16">
                                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                                </svg>
                                <span>Google</span>
                            </button>
                            <button class="start-auth-oauth-btn m-oauth-btn" id="startAppleSignInBtn">
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                                    <path d="M17.05 20.28c-.98.95-2.05.88-3.08.4-1.09-.5-2.08-.48-3.24 0-1.44.62-2.2.44-3.06-.4C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/>
                                </svg>
                                <span>Apple</span>
                            </button>
                            <button class="start-auth-oauth-btn m-oauth-btn" id="startGithubSignInBtn">
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                </svg>
                                <span>GitHub</span>
                            </button>
                        </div>
                        <button class="start-auth-email-btn m-btn m-btn-secondary m-btn-block" id="startEmailSignInBtn">
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                            </svg>
                            Sign in with Email
                        </button>
                    </div>
                    <!-- Signed in -->
                    <div class="start-auth-signed-in" id="startAuthSignedIn" style="display: none;">
                        <div class="start-auth-user">
                            <span class="m-icon m-icon-check-circle m-text-success"></span>
                            <span class="start-auth-email" id="startAuthUserEmail"></span>
                        </div>
                    </div>
                </div>
                
                <div class="start-screen-tip">
                    <svg class="tip-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                    <p>Tip: The extension will automatically detect when you navigate to new pages and show this screen to ensure accurate analysis.</p>
                </div>
            </div>
        </div>

        <!-- Auth Status Bar -->
        <div class="auth-bar" id="authBar">
            <div class="auth-bar-content" id="authBarSignedOut">
                <svg class="auth-bar-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                </svg>
                <span class="auth-bar-text">Not signed in</span>
                <button class="auth-bar-btn m-btn m-btn-primary m-btn-sm" id="authBarSignInBtn">Sign In</button>
            </div>
            <div class="auth-bar-content auth-bar-authenticated" id="authBarSignedIn" style="display: none;">
                <svg class="auth-bar-icon auth-bar-icon-ok" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
                <span class="auth-bar-text" id="authBarUserEmail"></span>
                <button class="auth-bar-btn auth-bar-btn-settings m-btn m-btn-icon m-btn-ghost m-btn-sm" id="authBarSettingsBtn">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
                        <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-navigation m-tabs">
            <button class="tab-btn m-tab m-tab-active active" data-tab="header-structure">
                <span class="m-icon m-icon-sm m-icon-headers tab-icon"></span>
                <span class="tab-text">Headers</span>
            </button>
            <button class="tab-btn m-tab" data-tab="text-content">
                <span class="m-icon m-icon-sm m-icon-file-text tab-icon"></span>
                <span class="tab-text">Text</span>
            </button>
            <button class="tab-btn m-tab" data-tab="link-analyzer">
                <span class="m-icon m-icon-sm m-icon-link tab-icon"></span>
                <span class="tab-text">Links</span>
            </button>
            <button class="tab-btn m-tab" data-tab="image-analyzer">
                <span class="m-icon m-icon-sm m-icon-image tab-icon"></span>
                <span class="tab-text">Images</span>
            </button>
            <button class="tab-btn m-tab" data-tab="summary-generator">
                <span class="m-icon m-icon-sm m-icon-file-text tab-icon"></span>
                <span class="tab-text">Summary</span>
            </button>
            <button class="tab-btn m-tab" data-tab="markdown-viewer">
                <span class="m-icon m-icon-sm m-icon-markdown tab-icon"></span>
                <span class="tab-text">Markdown</span>
            </button>
            <button class="tab-btn m-tab" data-tab="gemini-ai">
                <span class="m-icon m-icon-sm m-icon-sparkles tab-icon"></span>
                <span class="tab-text">Gemini</span>
            </button>
            <button class="tab-btn m-tab" data-tab="html-extraction">
                <span class="m-icon m-icon-sm m-icon-code tab-icon"></span>
                <span class="tab-text">HTML</span>
            </button>
            <button class="tab-btn m-tab" data-tab="ai-processing">
                <span class="m-icon m-icon-sm m-icon-bot tab-icon"></span>
                <span class="tab-text">AI</span>
            </button>
            <button class="tab-btn m-tab" data-tab="custom-range">
                <span class="m-icon m-icon-sm m-icon-target tab-icon"></span>
                <span class="tab-text">Custom</span>
            </button>
            <button class="tab-btn m-tab" data-tab="seo-analyzer">
                <span class="m-icon m-icon-sm m-icon-search tab-icon"></span>
                <span class="tab-text">SEO</span>
            </button>
            <button class="tab-btn m-tab" data-tab="fact-checker">
                <span class="m-icon m-icon-sm m-icon-check-circle tab-icon"></span>
                <span class="tab-text">Facts</span>
            </button>
        </div>
        
        <!-- Tab Content -->
        <div class="tab-content">
            <!-- HTML Extraction Tab -->
            <div id="html-extraction" class="tab-pane">
                <div class="tab-header">
                    <h3><span class="m-icon m-icon-wrench"></span> HTML Extraction</h3>
                    <p>Extract HTML content with various filtering options</p>
                </div>
                
                <button id="extractBtn" class="extract-btn m-btn m-btn-primary">
                    <span class="btn-text">Extract Current Page</span>
                    <span class="btn-loader" style="display: none;">Extracting...</span>
                </button>
                
                <button id="copyFullBtn" class="copy-btn m-btn">
                    <span class="btn-text"><span class="m-icon m-icon-copy"></span> Copy Full HTML</span>
                    <span class="btn-loader" style="display: none;">Copying...</span>
                </button>
                
                <button id="copySmartBtn" class="copy-btn copy-btn-smart m-btn">
                    <span class="btn-text"><span class="m-icon m-icon-sparkles"></span> Copy Smart HTML</span>
                    <span class="btn-loader" style="display: none;">Copying...</span>
                </button>
                
                <button id="copyCustomSmartBtn" class="copy-btn copy-btn-custom-smart m-btn">
                    <span class="btn-text"><span class="m-icon m-icon-target"></span> Copy Custom Smart HTML</span>
                    <span class="btn-loader" style="display: none;">Copying...</span>
                </button>
            </div>
            
            <!-- AI Processing Tab -->
            <div id="ai-processing" class="tab-pane">
                <div class="tab-header">
                    <h3><span class="m-icon m-icon-bot"></span> AI Processing</h3>
                    <p>Advanced AI analysis with database storage</p>
                </div>
                
                <button id="testApiBtn" class="test-api-btn m-btn m-btn-primary">
                    <span class="btn-text"><span class="m-icon m-icon-bot"></span> Test AI Processing</span>
                    <span class="btn-loader" style="display: none;">Processing...</span>
                </button>
                
                <button id="testApiSmartBtn" class="test-api-btn test-api-btn-smart m-btn m-btn-primary">
                    <span class="btn-text"><span class="m-icon m-icon-sparkles"></span> Test AI (Smart HTML)</span>
                    <span class="btn-loader" style="display: none;">Processing...</span>
                </button>
                
                <button id="testApiCustomSmartBtn" class="test-api-btn test-api-btn-custom-smart m-btn m-btn-primary">
                    <span class="btn-text"><span class="m-icon m-icon-target"></span> Test AI (Custom Smart HTML)</span>
                    <span class="btn-loader" style="display: none;">Processing...</span>
                </button>
                
                <div class="ai-response" id="aiResponse" style="display: none;">
                    <div class="ai-response-header">AI Processing Results:</div>
                    
                    <div class="ai-tabs m-tabs">
                        <button class="ai-tab m-tab m-tab-active active" data-tab="ai_content"><span class="m-icon m-icon-sm m-icon-bot"></span> AI Content</button>
                        <button class="ai-tab m-tab" data-tab="ai_research_content"><span class="m-icon m-icon-sm m-icon-search"></span> Research</button>
                        <button class="ai-tab m-tab" data-tab="markdown_renderable"><span class="m-icon m-icon-sm m-icon-file-text"></span> Markdown</button>
                        <button class="ai-tab m-tab" data-tab="organized_data"><span class="m-icon m-icon-sm m-icon-bar-chart"></span> JSON Data</button>
                        <button class="ai-tab m-tab" data-tab="full_response"><span class="m-icon m-icon-sm m-icon-wrench"></span> Full Response</button>
                    </div>
                    
                    <div class="ai-response-content" id="aiResponseContent"></div>
                    <div class="ai-response-actions">
                        <button id="copyAiBtn" class="ai-action-btn m-btn"><span class="m-icon m-icon-copy"></span> Copy Current</button>
                        <button id="viewMarkdownBtn" class="ai-action-btn ai-markdown-btn m-btn m-btn-ghost"><span class="m-icon m-icon-file-text"></span> View Markdown</button>
                        <div class="expand-buttons">
                            <button id="expandAiContentBtn" class="ai-expand-btn m-btn m-btn-ghost"><span class="m-icon m-icon-book-open"></span> AI Content</button>
                            <button id="expandResearchBtn" class="ai-expand-btn m-btn m-btn-ghost"><span class="m-icon m-icon-book-open"></span> Research</button>
                            <button id="expandMarkdownBtn" class="ai-expand-btn m-btn m-btn-ghost"><span class="m-icon m-icon-book-open"></span> Markdown</button>
                            <button id="expandJsonBtn" class="ai-expand-btn m-btn m-btn-ghost"><span class="m-icon m-icon-book-open"></span> JSON Data</button>
                            <button id="expandFullResponseBtn" class="ai-expand-btn m-btn m-btn-ghost"><span class="m-icon m-icon-book-open"></span> Full Response</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Gemini AI Tab -->
            <div id="gemini-ai" class="tab-pane">
                <div class="tab-header">
                    <h3><span class="m-icon m-icon-sparkles"></span> Gemini AI</h3>
                    <p>Direct Gemini API content extraction with local caching</p>
                </div>
                
                <!-- Saved Gemini Results Section -->
                <div id="geminiSavedResults" class="saved-results" style="display: none;">
                    <div class="saved-results-header">
                        <h4><span class="m-icon m-icon-folder"></span> Cached Results</h4>
                        <span id="geminiCacheTime" class="cache-time"></span>
                    </div>
                    <div class="saved-results-content" id="geminiSavedContent"></div>
                    <div class="saved-results-actions">
                        <button id="copyGeminiSavedBtn" class="gemini-action-btn m-btn"><span class="m-icon m-icon-copy"></span> Copy Cached Text</button>
                        <button id="expandGeminiSavedBtn" class="gemini-action-btn m-btn m-btn-ghost"><span class="m-icon m-icon-book-open"></span> View Full Text</button>
                        <button id="refreshGeminiBtn" class="gemini-refresh-btn m-btn m-btn-ghost"><span class="m-icon m-icon-refresh"></span> Refresh</button>
                    </div>
                </div>
                
                <!-- Gemini Extraction Buttons -->
                <div class="gemini-extraction">
                    <button id="geminiExtractFullBtn" class="gemini-btn gemini-btn-full m-btn m-btn-primary">
                        <span class="btn-text"><span class="m-icon m-icon-bot"></span> Extract Clean Text (Full HTML)</span>
                        <span class="btn-loader" style="display: none;">Extracting...</span>
                    </button>
                    
                    <button id="geminiExtractSmartBtn" class="gemini-btn gemini-btn-smart m-btn m-btn-primary">
                        <span class="btn-text"><span class="m-icon m-icon-sparkles"></span> Extract Clean Text (Smart HTML)</span>
                        <span class="btn-loader" style="display: none;">Extracting...</span>
                    </button>
                    
                    <button id="geminiExtractCustomBtn" class="gemini-btn gemini-btn-custom m-btn m-btn-primary">
                        <span class="btn-text"><span class="m-icon m-icon-target"></span> Extract Clean Text (Custom HTML)</span>
                        <span class="btn-loader" style="display: none;">Extracting...</span>
                    </button>
                </div>
                
                <!-- New Gemini Results -->
                <div class="gemini-response" id="geminiResponse" style="display: none;">
                    <div class="gemini-response-header"><span class="m-icon m-icon-bot"></span> Extracted Clean Text:</div>
                    <div class="gemini-response-content" id="geminiResponseContent"></div>
                    <div class="gemini-response-actions">
                        <button id="copyGeminiBtn" class="gemini-action-btn m-btn"><span class="m-icon m-icon-copy"></span> Copy Clean Text</button>
                        <button id="viewGeminiMarkdownBtn" class="gemini-action-btn gemini-markdown-btn m-btn m-btn-ghost"><span class="m-icon m-icon-file-text"></span> View as Markdown</button>
                        <button id="expandGeminiBtn" class="gemini-action-btn m-btn m-btn-ghost"><span class="m-icon m-icon-book-open"></span> View Full Text</button>
                    </div>
                </div>
            </div>
            
            <!-- Custom Range Tab -->
            <div id="custom-range" class="tab-pane">
                <div class="tab-header">
                    <h3><span class="m-icon m-icon-target"></span> Custom Range Extraction</h3>
                    <p>Extract content between specific HTML markers with optional Gemini processing</p>
                </div>
                
                <!-- Domain Info -->
                <div class="domain-info">
                    <div class="domain-label">Domain:</div>
                    <div class="domain-value" id="customRangeDomain">Loading...</div>
                </div>
                
                <!-- Marker Input Fields -->
                <div class="marker-inputs">
                    <div class="marker-group">
                        <label for="startMarker" class="marker-label">Start Marker (HTML to find):</label>
                        <textarea id="startMarker" class="marker-input" placeholder="Enter HTML marker like: &lt;div class=&quot;article-content&quot;&gt; or &lt;main&gt; or &lt;!-- article start --&gt;" rows="2"></textarea>
                        <div class="marker-actions">
                            <button id="testStartMarkerBtn" class="marker-test-btn" disabled>
                                <span class="btn-text"><span class="m-icon m-icon-search"></span> Test Start</span>
                                <span class="btn-loader" style="display: none;">Testing...</span>
                            </button>
                            <button id="saveStartMarkerBtn" class="marker-save-btn" disabled>
                                <span class="btn-text"><span class="m-icon m-icon-save"></span> Save Start</span>
                                <span class="btn-loader" style="display: none;">Saving...</span>
                            </button>
                        </div>
                        <div id="startMarkerResult" class="marker-result" style="display: none;"></div>
                    </div>
                    
                    <div class="marker-group">
                        <label for="endMarker" class="marker-label">End Marker (HTML to find):</label>
                        <textarea id="endMarker" class="marker-input" placeholder="Enter HTML marker like: &lt;/article&gt; or &lt;footer&gt; or &lt;!-- article end --&gt;" rows="2"></textarea>
                        <div class="marker-actions">
                            <button id="testEndMarkerBtn" class="marker-test-btn" disabled>
                                <span class="btn-text"><span class="m-icon m-icon-search"></span> Test End</span>
                                <span class="btn-loader" style="display: none;">Testing...</span>
                            </button>
                            <button id="saveEndMarkerBtn" class="marker-save-btn" disabled>
                                <span class="btn-text"><span class="m-icon m-icon-save"></span> Save End</span>
                                <span class="btn-loader" style="display: none;">Saving...</span>
                            </button>
                        </div>
                        <div id="endMarkerResult" class="marker-result" style="display: none;"></div>
                    </div>
                </div>
                
                <!-- Character Count Display -->
                <div class="character-count" id="characterCount" style="display: none;">
                    <div class="count-info">
                        <span class="count-label">Content Length:</span>
                        <span class="count-value" id="characterCountValue">0</span>
                        <span class="count-unit">characters</span>
                    </div>
                    <div class="count-preview" id="contentPreview"></div>
                </div>
                
                <!-- Action Buttons -->
                <div class="custom-range-actions">
                    <button id="previewRangeBtn" class="custom-range-btn preview-btn">
                        <span class="btn-text"><span class="m-icon m-icon-bar-chart"></span> Preview Content</span>
                        <span class="btn-loader" style="display: none;">Analyzing...</span>
                    </button>
                    
                    <button id="extractRangeBtn" class="custom-range-btn extract-btn" disabled>
                        <span class="btn-text"><span class="m-icon m-icon-copy"></span> Extract Content</span>
                        <span class="btn-loader" style="display: none;">Extracting...</span>
                    </button>
                    
                    <button id="geminiRangeBtn" class="custom-range-btn gemini-btn" disabled>
                        <span class="btn-text"><span class="m-icon m-icon-bot"></span> Extract + Gemini</span>
                        <span class="btn-loader" style="display: none;">Processing...</span>
                    </button>
                </div>
                
                <!-- Save/Load Markers -->
                <div class="marker-management">
                    <button id="saveMarkersBtn" class="marker-mgmt-btn m-btn"><span class="m-icon m-icon-save"></span> Save for Domain</button>
                    <button id="clearMarkersBtn" class="marker-mgmt-btn m-btn m-btn-danger"><span class="m-icon m-icon-trash"></span> Clear Markers</button>
                </div>
                
                <!-- Custom Range Results -->
                <div class="custom-range-results" id="customRangeResults" style="display: none;">
                    <div class="results-header">
                        <h4><span class="m-icon m-icon-file"></span> Extracted Content</h4>
                        <div class="results-info">
                            <span class="results-length" id="resultsLength">0 characters</span>
                        </div>
                    </div>
                    <div class="results-content" id="customRangeContent"></div>
                    <div class="results-actions">
                        <button id="copyCustomRangeBtn" class="results-action-btn m-btn"><span class="m-icon m-icon-copy"></span> Copy Content</button>
                        <button id="expandCustomRangeBtn" class="results-action-btn m-btn m-btn-ghost"><span class="m-icon m-icon-book-open"></span> View Full Content</button>
                    </div>
                </div>
            </div>
            
            <!-- Markdown Viewer Tab -->
            <div id="markdown-viewer" class="tab-pane">
                
                <!-- Markdown Content Status -->
                <div class="markdown-status" id="markdownStatus">
                    <div class="status-icon"><span class="m-icon m-icon-xl m-icon-file-text"></span></div>
                    <div class="status-text">
                        <h4>No Markdown Content</h4>
                        <p>Generate markdown content using AI Processing or Gemini extraction, then click "View Markdown" to display it here.</p>
                    </div>
                </div>
                
                <!-- Markdown Dual View Container -->
                <div class="markdown-viewer-container" id="markdownViewerContainer" style="display: none;">
                    <div class="markdown-header">
                        <h4 id="markdownTitle">Markdown Content</h4>
                        <div class="markdown-header-actions">
                            <button class="markdown-view-toggle active" data-view="formatted" id="formattedViewBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
                                </svg>
                                Formatted
                            </button>
                            <button class="markdown-view-toggle" data-view="raw" id="rawViewBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                                </svg>
                                Raw
                            </button>
                            <button class="markdown-copy-btn" id="markdownCopyBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/>
                                </svg>
                                Copy
                            </button>
                        </div>
                    </div>
                    
                    <!-- Formatted View -->
                    <div class="markdown-content-view formatted-view active" id="formattedView">
                        <div class="markdown-rendered-content" id="markdownRenderedContent">
                            <!-- Formatted markdown content will be rendered here -->
                        </div>
                    </div>
                    
                    <!-- Raw View -->
                    <div class="markdown-content-view raw-view" id="rawView">
                        <div class="markdown-raw-content" id="markdownRawContent">
                            <!-- Raw markdown content will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Header Structure Tab -->
            <div id="header-structure" class="tab-pane active">
                
                <!-- Header Analysis Status -->
                <div class="header-status" id="headerStatus">
                    <div class="status-icon"><span class="m-icon m-icon-xl m-icon-bar-chart"></span></div>
                    <div class="status-text">
                        <h4>Analyzing Headers...</h4>
                        <p>Extracting header structure from the current page.</p>
                    </div>
                </div>
                
                <!-- Header Structure Display -->
                <div class="header-structure-container" id="headerStructureContainer" style="display: none;">
                    <div class="header-structure-header">
                        <h4>Page Header Outline</h4>
                        <div class="header-actions">
                            <button class="header-copy-btn" id="headerCopyBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/>
                                </svg>
                                Copy Outline
                            </button>
                            <button class="header-refresh-btn" id="headerRefreshBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/>
                                </svg>
                                Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="header-stats" id="headerStats">
                        <!-- Header statistics will be displayed here -->
                    </div>
                    
                    <div class="header-structure-content" id="headerStructureContent">
                        <!-- Header outline will be displayed here -->
                    </div>
                </div>
            </div>
            
            <!-- Link Analyzer Tab -->
            <div id="link-analyzer" class="tab-pane">
                
                <!-- Link Analysis Status -->
                <div class="link-status" id="linkStatus">
                    <div class="status-icon"><span class="m-icon m-icon-xl m-icon-link"></span></div>
                    <div class="status-text">
                        <h4>Analyzing Links...</h4>
                        <p>Extracting links from the main page content.</p>
                    </div>
                </div>
                
                <!-- Link Structure Display -->
                <div class="link-structure-container" id="linkStructureContainer" style="display: none;">
                    <div class="link-structure-header">
                        <h4>Page Links Analysis</h4>
                        <div class="link-actions">
                            <div class="analysis-mode-toggle">
                                <button class="mode-toggle-btn active" data-mode="smart" id="linkSmartModeBtn">
                                    <svg class="btn-icon" viewBox="0 0 24 24">
                                        <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/>
                                    </svg>
                                    Smart
                                </button>
                                <button class="mode-toggle-btn" data-mode="full" id="linkFullModeBtn">
                                    <svg class="btn-icon" viewBox="0 0 24 24">
                                        <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/>
                                    </svg>
                                    Full
                                </button>
                            </div>
                            <button class="link-copy-btn" id="linkCopyBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/>
                                </svg>
                                Copy Links
                            </button>
                            <button class="link-refresh-btn" id="linkRefreshBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/>
                                </svg>
                                Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="link-stats" id="linkStats">
                        <!-- Link statistics will be displayed here -->
                    </div>
                    
                    <div class="link-structure-content" id="linkStructureContent">
                        <!-- Links will be displayed here -->
                    </div>
                </div>
            </div>
            
            <!-- Image Analyzer Tab -->
            <div id="image-analyzer" class="tab-pane">
                
                <!-- Image Analysis Status -->
                <div class="image-status" id="imageStatus">
                    <div class="status-icon"><span class="m-icon m-icon-xl m-icon-image"></span></div>
                    <div class="status-text">
                        <h4>Analyzing Images...</h4>
                        <p>Extracting images from the main page content.</p>
                    </div>
                </div>
                
                <!-- Image Structure Display -->
                <div class="image-structure-container" id="imageStructureContainer" style="display: none;">
                    <div class="image-structure-header">
                        <h4>Page Images Analysis</h4>
                        <div class="image-actions">
                            <div class="analysis-mode-toggle">
                                <button class="mode-toggle-btn active" data-mode="smart" id="imageSmartModeBtn">
                                    <svg class="btn-icon" viewBox="0 0 24 24">
                                        <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/>
                                    </svg>
                                    Smart
                                </button>
                                <button class="mode-toggle-btn" data-mode="full" id="imageFullModeBtn">
                                    <svg class="btn-icon" viewBox="0 0 24 24">
                                        <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/>
                                    </svg>
                                    Full
                                </button>
                            </div>
                            <button class="image-copy-btn" id="imageCopyBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/>
                                </svg>
                                Copy Images
                            </button>
                            <button class="image-refresh-btn" id="imageRefreshBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/>
                                </svg>
                                Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="image-stats" id="imageStats">
                        <!-- Image statistics will be displayed here -->
                    </div>
                    
                    <div class="image-structure-content" id="imageStructureContent">
                        <!-- Images will be displayed here -->
                    </div>
                </div>
            </div>
            
            <!-- Text Content Tab -->
            <div id="text-content" class="tab-pane">
                
                <!-- Text Content Status -->
                <div class="text-status" id="textStatus">
                    <div class="status-icon"><span class="m-icon m-icon-xl m-icon-file-text"></span></div>
                    <div class="status-text">
                        <h4>Text Content Extractor</h4>
                        <p>Extract readable text content from the current page</p>
                    </div>
                </div>
                
                <!-- Text Content Display -->
                <div class="text-content-container" id="textContentContainer" style="display: none;">
                    <div class="text-content-header">
                        <h4>Page Text Content</h4>
                        <div class="text-actions">
                            <button class="text-copy-btn" id="textCopyBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/>
                                </svg>
                                Copy Text
                            </button>
                            <button class="text-refresh-btn" id="textRefreshBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/>
                                </svg>
                                Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="text-stats" id="textStats">
                        <!-- Text statistics will be displayed here -->
                    </div>
                    
                    <div class="text-content-display" id="textContentDisplay">
                        <!-- Extracted text will be displayed here -->
                    </div>
                </div>
            </div>
            
            <!-- Future Feature Tabs (Placeholders) -->
            
            <div id="seo-analyzer" class="tab-pane">
                <div class="tab-header">
                    <h3><span class="m-icon m-icon-search"></span> SEO Analyzer</h3>
                    <p>Comprehensive SEO analysis and recommendations</p>
                </div>
                <div class="placeholder-content m-empty">
                    <span class="m-icon m-icon-xl m-icon-search m-empty-icon placeholder-icon"></span>
                    <h4>Coming Soon</h4>
                    <p>SEO analysis will provide insights into page optimization, meta tags, and search engine visibility.</p>
                </div>
            </div>
            
            <div id="fact-checker" class="tab-pane">
                <div class="tab-header">
                    <h3><span class="m-icon m-icon-check-circle"></span> Fact Checker</h3>
                    <p>Verify claims and statements on the page</p>
                </div>
                <div class="placeholder-content m-empty">
                    <span class="m-icon m-icon-xl m-icon-check-circle m-empty-icon placeholder-icon"></span>
                    <h4>Coming Soon</h4>
                    <p>Fact checking will help verify the accuracy of claims and statements found on the page.</p>
                </div>
            </div>
            
            <div id="link-analyzer" class="tab-pane">
                <div class="tab-header">
                    <h3><span class="m-icon m-icon-link"></span> Link Analyzer</h3>
                    <p>Analyze internal and external links</p>
                </div>
                <div class="placeholder-content m-empty">
                    <span class="m-icon m-icon-xl m-icon-link m-empty-icon placeholder-icon"></span>
                    <h4>Coming Soon</h4>
                    <p>Link analysis will examine all links on the page, checking their status and relevance.</p>
                </div>
            </div>
            
            <div id="image-analyzer" class="tab-pane">
                <div class="tab-header">
                    <h3><span class="m-icon m-icon-image"></span> Image Analyzer</h3>
                    <p>Analyze images, alt text, and optimization</p>
                </div>
                <div class="placeholder-content m-empty">
                    <span class="m-icon m-icon-xl m-icon-image m-empty-icon placeholder-icon"></span>
                    <h4>Coming Soon</h4>
                    <p>Image analysis will examine all images for optimization, accessibility, and SEO best practices.</p>
                </div>
            </div>
            
            <!-- Summary Generator Tab -->
            <div id="summary-generator" class="tab-pane">
                
                <!-- Summary Content Status -->
                <div class="summary-status" id="summaryStatus" style="display: block;">
                    <div class="status-icon"><span class="m-icon m-icon-xl m-icon-file"></span></div>
                    <div class="status-text">
                        <h4>AI Summary Generator</h4>
                        <p>Generate a concise summary of the page content using AI</p>
                    </div>
                </div>
                
                <!-- Summary Dual View Container -->
                <div class="summary-viewer-container" id="summaryViewerContainer" style="display: none;">
                    <div class="summary-header">
                        <h4 id="summaryTitle">Page Summary</h4>
                        <div class="summary-header-actions">
                            <button class="summary-view-toggle active" data-view="formatted" id="summaryFormattedViewBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
                                </svg>
                                Formatted
                            </button>
                            <button class="summary-view-toggle" data-view="raw" id="summaryRawViewBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                                </svg>
                                Raw
                            </button>
                            <button class="summary-copy-btn" id="summaryCopyBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/>
                                </svg>
                                Copy
                            </button>
                        </div>
                    </div>
                    
                    <!-- Formatted View -->
                    <div class="summary-content-view formatted-view active" id="summaryFormattedView">
                        <div class="markdown-rendered-content" id="summaryRenderedContent">
                            <!-- Formatted summary content will be rendered here -->
                        </div>
                    </div>
                    
                    <!-- Raw View -->
                    <div class="summary-content-view raw-view" id="summaryRawView">
                        <div class="summary-raw-content" id="summaryRawContent">
                            <!-- Raw summary content will be displayed here -->
                        </div>
                    </div>
                </div>

                <div class="summary-generator-actions">
                    <button class="generate-summary-btn" id="generateSummaryBtn">
                        <svg class="btn-icon" viewBox="0 0 24 24">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                        <span class="btn-text">Generate Summary</span>
                        <span class="btn-loader" style="display: none;">
                            <svg viewBox="0 0 24 24" class="spin">
                                <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="4" opacity="0.25"/>
                                <path fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" opacity="0.75"/>
                            </svg>
                            Generating...
                        </span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Global Status and Info -->
        <div class="global-info">
            <div class="status" id="status" style="display: none;">
                <div class="status-message" id="statusMessage"></div>
            </div>
            
            <div class="info">
                <div class="info-item">
                    <span class="label">Current URL:</span>
                    <span class="value" id="currentUrl">Loading...</span>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <button class="refresh-url-btn m-btn m-btn-ghost" id="refreshUrlBtn" title="Refresh current page data">
                <svg class="refresh-icon" viewBox="0 0 24 24">
                    <path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/>
                </svg>
                <span class="refresh-text">Refresh</span>
            </button>
            <button class="settings-btn m-btn m-btn-ghost" id="settingsLink">
                <svg class="settings-icon" viewBox="0 0 24 24">
                    <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                </svg>
                <span class="settings-text">Settings</span>
            </button>
        </div>
    </div>
    
    <!-- Markdown rendering libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.11/purify.min.js"></script>
    
    <!-- Centralized Markdown Utility -->
    <script src="../lib/markdown-utils.js"></script>
    <script>
        // Initialize markdown utilities when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                if (window.MarkdownUtils) {
                    window.MarkdownUtils.init();
                }
            });
        } else {
            if (window.MarkdownUtils) {
                window.MarkdownUtils.init();
            }
        }
    </script>
    
    <script src="../popup/template-loader.js"></script>
    <script src="sidepanel.js"></script>
</body>
</html>
