<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matrx Side Panel</title>
    <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
    <div class="container">
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn active" data-tab="html-extraction">
                <svg class="tab-icon" viewBox="0 0 24 24" style="fill: #34A853;">
                    <path d="M12,17.56L16.07,16.43L16.62,10.33H9.38L9.2,8.3H16.8L17,6.31H7L7.56,12.32H14.45L14.22,14.9L12,15.5L9.78,14.9L9.64,13.24H7.64L7.93,16.43L12,17.56M4.07,3H19.93L18.5,19.2L12,21L5.5,19.2L4.07,3Z"/>
                </svg>
                <span class="tab-text">HTML</span>
            </button>
            <button class="tab-btn" data-tab="ai-processing">
                <svg class="tab-icon" viewBox="0 0 24 24" style="fill: #4285F4;">
                    <path d="M16,12A2,2 0 0,1 18,10A2,2 0 0,1 20,12A2,2 0 0,1 18,14A2,2 0 0,1 16,12M10,12A2,2 0 0,1 12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12M4,12A2,2 0 0,1 6,10A2,2 0 0,1 8,12A2,2 0 0,1 6,14A2,2 0 0,1 4,12Z"/>
                </svg>
                <span class="tab-text">AI</span>
            </button>
            <button class="tab-btn" data-tab="gemini-ai">
                <svg class="tab-icon" viewBox="0 0 24 24" style="fill: #EA4335;">
                    <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L19 8L21 9ZM15 8.5C15 7.1 16.1 6 17.5 6S20 7.1 20 8.5 18.9 11 17.5 11 15 9.9 15 8.5ZM6.5 6C7.9 6 9 7.1 9 8.5S7.9 11 6.5 11 4 9.9 4 8.5 5.1 6 6.5 6ZM3 9L5 8L3 7V9ZM12 7.5C13.9 7.5 15.5 9.1 15.5 11S13.9 14.5 12 14.5 8.5 12.9 8.5 11 10.1 7.5 12 7.5ZM12 22L8 18H16L12 22Z"/>
                </svg>
                <span class="tab-text">Gemini</span>
            </button>
            <button class="tab-btn" data-tab="custom-range">
                <svg class="tab-icon" viewBox="0 0 24 24" style="fill: #FBBC04;">
                    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                </svg>
                <span class="tab-text">Custom</span>
            </button>
            <button class="tab-btn" data-tab="markdown-viewer">
                <svg class="tab-icon" viewBox="0 0 24 24" style="fill: #9C27B0;">
                    <path d="M14,17H7V15H14M17,13H7V11H17M17,9H7V7H17M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z"/>
                </svg>
                <span class="tab-text">Markdown</span>
            </button>
            <button class="tab-btn" data-tab="header-structure">
                <svg class="tab-icon" viewBox="0 0 24 24" style="fill: #FF9800;">
                    <path d="M3,4H7V8H3V4M9,5V7H21V5H9M3,10H7V14H3V10M9,11V13H21V11H9M3,16H7V20H3V16M9,17V19H21V17H9"/>
                </svg>
                <span class="tab-text">Headers</span>
            </button>
            <button class="tab-btn" data-tab="seo-analyzer">
                <svg class="tab-icon" viewBox="0 0 24 24" style="fill: #607D8B;">
                    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                </svg>
                <span class="tab-text">SEO</span>
            </button>
            <button class="tab-btn" data-tab="fact-checker">
                <svg class="tab-icon" viewBox="0 0 24 24" style="fill: #4CAF50;">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
                <span class="tab-text">Facts</span>
            </button>
            <button class="tab-btn" data-tab="link-analyzer">
                <svg class="tab-icon" viewBox="0 0 24 24" style="fill: #2196F3;">
                    <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
                </svg>
                <span class="tab-text">Links</span>
            </button>
            <button class="tab-btn" data-tab="image-analyzer">
                <svg class="tab-icon" viewBox="0 0 24 24" style="fill: #E91E63;">
                    <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
                </svg>
                <span class="tab-text">Images</span>
            </button>
            <button class="tab-btn" data-tab="summary-generator">
                <svg class="tab-icon" viewBox="0 0 24 24" style="fill: #FF5722;">
                    <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                </svg>
                <span class="tab-text">Summary</span>
            </button>
        </div>
        
        <!-- Tab Content -->
        <div class="tab-content">
            <!-- HTML Extraction Tab -->
            <div id="html-extraction" class="tab-pane active">
                <div class="tab-header">
                    <h3>üîß HTML Extraction</h3>
                    <p>Extract HTML content with various filtering options</p>
                </div>
                
                <button id="extractBtn" class="extract-btn">
                    <span class="btn-text">Extract Current Page</span>
                    <span class="btn-loader" style="display: none;">Extracting...</span>
                </button>
                
                <button id="copyFullBtn" class="copy-btn">
                    <span class="btn-text">üìã Copy Full HTML</span>
                    <span class="btn-loader" style="display: none;">Copying...</span>
                </button>
                
                <button id="copySmartBtn" class="copy-btn copy-btn-smart">
                    <span class="btn-text">‚ú® Copy Smart HTML</span>
                    <span class="btn-loader" style="display: none;">Copying...</span>
                </button>
                
                <button id="copyCustomSmartBtn" class="copy-btn copy-btn-custom-smart">
                    <span class="btn-text">üéØ Copy Custom Smart HTML</span>
                    <span class="btn-loader" style="display: none;">Copying...</span>
                </button>
            </div>
            
            <!-- AI Processing Tab -->
            <div id="ai-processing" class="tab-pane">
                <div class="tab-header">
                    <h3>ü§ñ AI Processing</h3>
                    <p>Advanced AI analysis with database storage</p>
                </div>
                
                <button id="testApiBtn" class="test-api-btn">
                    <span class="btn-text">ü§ñ Test AI Processing</span>
                    <span class="btn-loader" style="display: none;">Processing...</span>
                </button>
                
                <button id="testApiSmartBtn" class="test-api-btn test-api-btn-smart">
                    <span class="btn-text">‚ú® Test AI (Smart HTML)</span>
                    <span class="btn-loader" style="display: none;">Processing...</span>
                </button>
                
                <button id="testApiCustomSmartBtn" class="test-api-btn test-api-btn-custom-smart">
                    <span class="btn-text">üéØ Test AI (Custom Smart HTML)</span>
                    <span class="btn-loader" style="display: none;">Processing...</span>
                </button>
                
                <div class="ai-response" id="aiResponse" style="display: none;">
                    <div class="ai-response-header">AI Processing Results:</div>
                    
                    <div class="ai-tabs">
                        <button class="ai-tab active" data-tab="ai_content">ü§ñ AI Content</button>
                        <button class="ai-tab" data-tab="ai_research_content">üîç Research</button>
                        <button class="ai-tab" data-tab="markdown_renderable">üìù Markdown</button>
                        <button class="ai-tab" data-tab="organized_data">üìä JSON Data</button>
                        <button class="ai-tab" data-tab="full_response">üîß Full Response</button>
                    </div>
                    
                    <div class="ai-response-content" id="aiResponseContent"></div>
                    <div class="ai-response-actions">
                        <button id="copyAiBtn" class="ai-action-btn">üìã Copy Current</button>
                        <button id="viewMarkdownBtn" class="ai-action-btn ai-markdown-btn">üìù View Markdown</button>
                        <div class="expand-buttons">
                            <button id="expandAiContentBtn" class="ai-expand-btn">üìñ AI Content</button>
                            <button id="expandResearchBtn" class="ai-expand-btn">üìñ Research</button>
                            <button id="expandMarkdownBtn" class="ai-expand-btn">üìñ Markdown</button>
                            <button id="expandJsonBtn" class="ai-expand-btn">üìñ JSON Data</button>
                            <button id="expandFullResponseBtn" class="ai-expand-btn">üìñ Full Response</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Gemini AI Tab -->
            <div id="gemini-ai" class="tab-pane">
                <div class="tab-header">
                    <h3>‚ú® Gemini AI</h3>
                    <p>Direct Gemini API content extraction with local caching</p>
                </div>
                
                <!-- Saved Gemini Results Section -->
                <div id="geminiSavedResults" class="saved-results" style="display: none;">
                    <div class="saved-results-header">
                        <h4>üìÅ Cached Results</h4>
                        <span id="geminiCacheTime" class="cache-time"></span>
                    </div>
                    <div class="saved-results-content" id="geminiSavedContent"></div>
                    <div class="saved-results-actions">
                        <button id="copyGeminiSavedBtn" class="gemini-action-btn">üìã Copy Cached Text</button>
                        <button id="expandGeminiSavedBtn" class="gemini-action-btn">üìñ View Full Text</button>
                        <button id="refreshGeminiBtn" class="gemini-refresh-btn">üîÑ Refresh</button>
                    </div>
                </div>
                
                <!-- Gemini Extraction Buttons -->
                <div class="gemini-extraction">
                    <button id="geminiExtractFullBtn" class="gemini-btn gemini-btn-full">
                        <span class="btn-text">ü§ñ Extract Clean Text (Full HTML)</span>
                        <span class="btn-loader" style="display: none;">Extracting...</span>
                    </button>
                    
                    <button id="geminiExtractSmartBtn" class="gemini-btn gemini-btn-smart">
                        <span class="btn-text">‚ú® Extract Clean Text (Smart HTML)</span>
                        <span class="btn-loader" style="display: none;">Extracting...</span>
                    </button>
                    
                    <button id="geminiExtractCustomBtn" class="gemini-btn gemini-btn-custom">
                        <span class="btn-text">üéØ Extract Clean Text (Custom HTML)</span>
                        <span class="btn-loader" style="display: none;">Extracting...</span>
                    </button>
                </div>
                
                <!-- New Gemini Results -->
                <div class="gemini-response" id="geminiResponse" style="display: none;">
                    <div class="gemini-response-header">ü§ñ Extracted Clean Text:</div>
                    <div class="gemini-response-content" id="geminiResponseContent"></div>
                    <div class="gemini-response-actions">
                        <button id="copyGeminiBtn" class="gemini-action-btn">üìã Copy Clean Text</button>
                        <button id="viewGeminiMarkdownBtn" class="gemini-action-btn gemini-markdown-btn">üìù View as Markdown</button>
                        <button id="expandGeminiBtn" class="gemini-action-btn">üìñ View Full Text</button>
                    </div>
                </div>
            </div>
            
            <!-- Custom Range Tab -->
            <div id="custom-range" class="tab-pane">
                <div class="tab-header">
                    <h3>üéØ Custom Range Extraction</h3>
                    <p>Extract content between specific HTML markers with optional Gemini processing</p>
                </div>
                
                <!-- Domain Info -->
                <div class="domain-info">
                    <div class="domain-label">Domain:</div>
                    <div class="domain-value" id="customRangeDomain">Loading...</div>
                </div>
                
                <!-- Marker Input Fields -->
                <div class="marker-inputs">
                    <div class="marker-group">
                        <label for="startMarker" class="marker-label">Start Marker (HTML to find):</label>
                        <textarea id="startMarker" class="marker-input" placeholder="Enter HTML marker like: &lt;div class=&quot;article-content&quot;&gt; or &lt;main&gt; or &lt;!-- article start --&gt;" rows="2"></textarea>
                        <div class="marker-actions">
                            <button id="testStartMarkerBtn" class="marker-test-btn" disabled>
                                <span class="btn-text">üîç Test Start</span>
                                <span class="btn-loader" style="display: none;">Testing...</span>
                            </button>
                            <button id="saveStartMarkerBtn" class="marker-save-btn" disabled>
                                <span class="btn-text">üíæ Save Start</span>
                                <span class="btn-loader" style="display: none;">Saving...</span>
                            </button>
                        </div>
                        <div id="startMarkerResult" class="marker-result" style="display: none;"></div>
                    </div>
                    
                    <div class="marker-group">
                        <label for="endMarker" class="marker-label">End Marker (HTML to find):</label>
                        <textarea id="endMarker" class="marker-input" placeholder="Enter HTML marker like: &lt;/article&gt; or &lt;footer&gt; or &lt;!-- article end --&gt;" rows="2"></textarea>
                        <div class="marker-actions">
                            <button id="testEndMarkerBtn" class="marker-test-btn" disabled>
                                <span class="btn-text">üîç Test End</span>
                                <span class="btn-loader" style="display: none;">Testing...</span>
                            </button>
                            <button id="saveEndMarkerBtn" class="marker-save-btn" disabled>
                                <span class="btn-text">üíæ Save End</span>
                                <span class="btn-loader" style="display: none;">Saving...</span>
                            </button>
                        </div>
                        <div id="endMarkerResult" class="marker-result" style="display: none;"></div>
                    </div>
                </div>
                
                <!-- Character Count Display -->
                <div class="character-count" id="characterCount" style="display: none;">
                    <div class="count-info">
                        <span class="count-label">Content Length:</span>
                        <span class="count-value" id="characterCountValue">0</span>
                        <span class="count-unit">characters</span>
                    </div>
                    <div class="count-preview" id="contentPreview"></div>
                </div>
                
                <!-- Action Buttons -->
                <div class="custom-range-actions">
                    <button id="previewRangeBtn" class="custom-range-btn preview-btn">
                        <span class="btn-text">üìä Preview Content</span>
                        <span class="btn-loader" style="display: none;">Analyzing...</span>
                    </button>
                    
                    <button id="extractRangeBtn" class="custom-range-btn extract-btn" disabled>
                        <span class="btn-text">üìã Extract Content</span>
                        <span class="btn-loader" style="display: none;">Extracting...</span>
                    </button>
                    
                    <button id="geminiRangeBtn" class="custom-range-btn gemini-btn" disabled>
                        <span class="btn-text">ü§ñ Extract + Gemini</span>
                        <span class="btn-loader" style="display: none;">Processing...</span>
                    </button>
                </div>
                
                <!-- Save/Load Markers -->
                <div class="marker-management">
                    <button id="saveMarkersBtn" class="marker-mgmt-btn">üíæ Save for Domain</button>
                    <button id="clearMarkersBtn" class="marker-mgmt-btn">üóëÔ∏è Clear Markers</button>
                </div>
                
                <!-- Custom Range Results -->
                <div class="custom-range-results" id="customRangeResults" style="display: none;">
                    <div class="results-header">
                        <h4>üìÑ Extracted Content</h4>
                        <div class="results-info">
                            <span class="results-length" id="resultsLength">0 characters</span>
                        </div>
                    </div>
                    <div class="results-content" id="customRangeContent"></div>
                    <div class="results-actions">
                        <button id="copyCustomRangeBtn" class="results-action-btn">üìã Copy Content</button>
                        <button id="expandCustomRangeBtn" class="results-action-btn">üìñ View Full Content</button>
                    </div>
                </div>
            </div>
            
            <!-- Markdown Viewer Tab -->
            <div id="markdown-viewer" class="tab-pane">
                
                <!-- Markdown Content Status -->
                <div class="markdown-status" id="markdownStatus">
                    <div class="status-icon">üìù</div>
                    <div class="status-text">
                        <h4>No Markdown Content</h4>
                        <p>Generate markdown content using AI Processing or Gemini extraction, then click "View Markdown" to display it here.</p>
                    </div>
                </div>
                
                <!-- Markdown Dual View Container -->
                <div class="markdown-viewer-container" id="markdownViewerContainer" style="display: none;">
                    <div class="markdown-header">
                        <h4 id="markdownTitle">Markdown Content</h4>
                        <div class="markdown-header-actions">
                            <button class="markdown-view-toggle active" data-view="formatted" id="formattedViewBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
                                </svg>
                                Formatted
                            </button>
                            <button class="markdown-view-toggle" data-view="raw" id="rawViewBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                                </svg>
                                Raw
                            </button>
                            <button class="markdown-copy-btn" id="markdownCopyBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/>
                                </svg>
                                Copy
                            </button>
                        </div>
                    </div>
                    
                    <!-- Formatted View -->
                    <div class="markdown-content-view formatted-view active" id="formattedView">
                        <div class="markdown-rendered-content" id="markdownRenderedContent">
                            <!-- Formatted markdown content will be rendered here -->
                        </div>
                    </div>
                    
                    <!-- Raw View -->
                    <div class="markdown-content-view raw-view" id="rawView">
                        <div class="markdown-raw-content" id="markdownRawContent">
                            <!-- Raw markdown content will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Header Structure Tab -->
            <div id="header-structure" class="tab-pane">
                
                <!-- Header Analysis Status -->
                <div class="header-status" id="headerStatus">
                    <div class="status-icon">üìä</div>
                    <div class="status-text">
                        <h4>Analyzing Headers...</h4>
                        <p>Extracting header structure from the current page.</p>
                    </div>
                </div>
                
                <!-- Header Structure Display -->
                <div class="header-structure-container" id="headerStructureContainer" style="display: none;">
                    <div class="header-structure-header">
                        <h4>Page Header Outline</h4>
                        <div class="header-actions">
                            <button class="header-copy-btn" id="headerCopyBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/>
                                </svg>
                                Copy Outline
                            </button>
                            <button class="header-refresh-btn" id="headerRefreshBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/>
                                </svg>
                                Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="header-stats" id="headerStats">
                        <!-- Header statistics will be displayed here -->
                    </div>
                    
                    <div class="header-structure-content" id="headerStructureContent">
                        <!-- Header outline will be displayed here -->
                    </div>
                </div>
            </div>
            
            <!-- Link Analyzer Tab -->
            <div id="link-analyzer" class="tab-pane">
                
                <!-- Link Analysis Status -->
                <div class="link-status" id="linkStatus">
                    <div class="status-icon">üîó</div>
                    <div class="status-text">
                        <h4>Analyzing Links...</h4>
                        <p>Extracting links from the main page content.</p>
                    </div>
                </div>
                
                <!-- Link Structure Display -->
                <div class="link-structure-container" id="linkStructureContainer" style="display: none;">
                    <div class="link-structure-header">
                        <h4>Page Links Analysis</h4>
                        <div class="link-actions">
                            <div class="analysis-mode-toggle">
                                <button class="mode-toggle-btn active" data-mode="smart" id="linkSmartModeBtn">
                                    <svg class="btn-icon" viewBox="0 0 24 24">
                                        <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/>
                                    </svg>
                                    Smart
                                </button>
                                <button class="mode-toggle-btn" data-mode="full" id="linkFullModeBtn">
                                    <svg class="btn-icon" viewBox="0 0 24 24">
                                        <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/>
                                    </svg>
                                    Full
                                </button>
                            </div>
                            <button class="link-copy-btn" id="linkCopyBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/>
                                </svg>
                                Copy Links
                            </button>
                            <button class="link-refresh-btn" id="linkRefreshBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/>
                                </svg>
                                Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="link-stats" id="linkStats">
                        <!-- Link statistics will be displayed here -->
                    </div>
                    
                    <div class="link-structure-content" id="linkStructureContent">
                        <!-- Links will be displayed here -->
                    </div>
                </div>
            </div>
            
            <!-- Image Analyzer Tab -->
            <div id="image-analyzer" class="tab-pane">
                
                <!-- Image Analysis Status -->
                <div class="image-status" id="imageStatus">
                    <div class="status-icon">üñºÔ∏è</div>
                    <div class="status-text">
                        <h4>Analyzing Images...</h4>
                        <p>Extracting images from the main page content.</p>
                    </div>
                </div>
                
                <!-- Image Structure Display -->
                <div class="image-structure-container" id="imageStructureContainer" style="display: none;">
                    <div class="image-structure-header">
                        <h4>Page Images Analysis</h4>
                        <div class="image-actions">
                            <div class="analysis-mode-toggle">
                                <button class="mode-toggle-btn active" data-mode="smart" id="imageSmartModeBtn">
                                    <svg class="btn-icon" viewBox="0 0 24 24">
                                        <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/>
                                    </svg>
                                    Smart
                                </button>
                                <button class="mode-toggle-btn" data-mode="full" id="imageFullModeBtn">
                                    <svg class="btn-icon" viewBox="0 0 24 24">
                                        <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/>
                                    </svg>
                                    Full
                                </button>
                            </div>
                            <button class="image-copy-btn" id="imageCopyBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/>
                                </svg>
                                Copy Images
                            </button>
                            <button class="image-refresh-btn" id="imageRefreshBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/>
                                </svg>
                                Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="image-stats" id="imageStats">
                        <!-- Image statistics will be displayed here -->
                    </div>
                    
                    <div class="image-structure-content" id="imageStructureContent">
                        <!-- Images will be displayed here -->
                    </div>
                </div>
            </div>
            
            <!-- Future Feature Tabs (Placeholders) -->
            
            <div id="seo-analyzer" class="tab-pane">
                <div class="tab-header">
                    <h3>üîç SEO Analyzer</h3>
                    <p>Comprehensive SEO analysis and recommendations</p>
                </div>
                <div class="placeholder-content">
                    <div class="placeholder-icon">üîç</div>
                    <h4>Coming Soon</h4>
                    <p>SEO analysis will provide insights into page optimization, meta tags, and search engine visibility.</p>
                </div>
            </div>
            
            <div id="fact-checker" class="tab-pane">
                <div class="tab-header">
                    <h3>‚úÖ Fact Checker</h3>
                    <p>Verify claims and statements on the page</p>
                </div>
                <div class="placeholder-content">
                    <div class="placeholder-icon">‚úÖ</div>
                    <h4>Coming Soon</h4>
                    <p>Fact checking will help verify the accuracy of claims and statements found on the page.</p>
                </div>
            </div>
            
            <div id="link-analyzer" class="tab-pane">
                <div class="tab-header">
                    <h3>üîó Link Analyzer</h3>
                    <p>Analyze internal and external links</p>
                </div>
                <div class="placeholder-content">
                    <div class="placeholder-icon">üîó</div>
                    <h4>Coming Soon</h4>
                    <p>Link analysis will examine all links on the page, checking their status and relevance.</p>
                </div>
            </div>
            
            <div id="image-analyzer" class="tab-pane">
                <div class="tab-header">
                    <h3>üñºÔ∏è Image Analyzer</h3>
                    <p>Analyze images, alt text, and optimization</p>
                </div>
                <div class="placeholder-content">
                    <div class="placeholder-icon">üñºÔ∏è</div>
                    <h4>Coming Soon</h4>
                    <p>Image analysis will examine all images for optimization, accessibility, and SEO best practices.</p>
                </div>
            </div>
            
            <!-- Summary Generator Tab -->
            <div id="summary-generator" class="tab-pane">
                
                <!-- Summary Content Status -->
                <div class="summary-status" id="summaryStatus" style="display: block;">
                    <div class="status-icon">üìÑ</div>
                    <div class="status-text">
                        <h4>AI Summary Generator</h4>
                        <p>Generate a concise summary of the page content using AI</p>
                    </div>
                </div>
                
                <!-- Summary Dual View Container -->
                <div class="summary-viewer-container" id="summaryViewerContainer" style="display: none;">
                    <div class="summary-header">
                        <h4 id="summaryTitle">Page Summary</h4>
                        <div class="summary-header-actions">
                            <button class="summary-view-toggle active" data-view="formatted" id="summaryFormattedViewBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
                                </svg>
                                Formatted
                            </button>
                            <button class="summary-view-toggle" data-view="raw" id="summaryRawViewBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                                </svg>
                                Raw
                            </button>
                            <button class="summary-copy-btn" id="summaryCopyBtn">
                                <svg class="btn-icon" viewBox="0 0 24 24">
                                    <path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/>
                                </svg>
                                Copy
                            </button>
                        </div>
                    </div>
                    
                    <!-- Formatted View -->
                    <div class="summary-content-view formatted-view active" id="summaryFormattedView">
                        <div class="markdown-rendered-content" id="summaryRenderedContent">
                            <!-- Formatted summary content will be rendered here -->
                        </div>
                    </div>
                    
                    <!-- Raw View -->
                    <div class="summary-content-view raw-view" id="summaryRawView">
                        <div class="summary-raw-content" id="summaryRawContent">
                            <!-- Raw summary content will be displayed here -->
                        </div>
                    </div>
                </div>

                <div class="summary-generator-actions">
                    <button class="generate-summary-btn" id="generateSummaryBtn">
                        <svg class="btn-icon" viewBox="0 0 24 24">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                        <span class="btn-text">Generate Summary</span>
                        <span class="btn-loader" style="display: none;">
                            <svg viewBox="0 0 24 24" class="spin">
                                <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="4" opacity="0.25"/>
                                <path fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" opacity="0.75"/>
                            </svg>
                            Generating...
                        </span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Global Status and Info -->
        <div class="global-info">
            <div class="status" id="status" style="display: none;">
                <div class="status-message" id="statusMessage"></div>
            </div>
            
            <div class="info">
                <div class="info-item">
                    <span class="label">Current URL:</span>
                    <span class="value" id="currentUrl">Loading...</span>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <button class="refresh-url-btn" id="refreshUrlBtn" title="Refresh current page data">
                <svg class="refresh-icon" viewBox="0 0 24 24">
                    <path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/>
                </svg>
                <span class="refresh-text">Refresh</span>
            </button>
            <button class="settings-btn" id="settingsLink">
                <svg class="settings-icon" viewBox="0 0 24 24">
                    <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                </svg>
                <span class="settings-text">Settings</span>
            </button>
        </div>
    </div>
    
    <!-- Markdown rendering libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.11/purify.min.js"></script>
    
    <!-- Centralized Markdown Utility -->
    <script src="../lib/markdown-utils.js"></script>
    <script>
        // Initialize markdown utilities when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                if (window.MarkdownUtils) {
                    window.MarkdownUtils.init();
                }
            });
        } else {
            if (window.MarkdownUtils) {
                window.MarkdownUtils.init();
            }
        }
    </script>
    
    <script src="../popup/template-loader.js"></script>
    <script src="sidepanel.js"></script>
</body>
</html>
